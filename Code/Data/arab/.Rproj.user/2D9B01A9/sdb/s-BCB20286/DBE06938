{
    "contents" : "\narab.3 <- read.csv(\"/home/zhuob/Dropbox/Zhuo/Project_2014/arab/arabCtrl.csv\", header=T)\n\n\narab.3 <- read.csv(\"C:/Users/zhuob/Dropbox/Zhuo/Project_2014/arab/arabCtrl.csv\", header=T)\n\ns1 <- apply(arab.3[,3:5],1, mean)\ns2 <- apply(arab.3[, 6:7], 1, mean)\ns3 <- apply(arab.3[, 8:10], 1, mean)\ns4 <- apply(arab.3[, 11:13], 1, mean)\n\n\npdf(\"C:/Users/zhuob/Dropbox/Zhuo/FindData/arab/log_mean.pdf\",width=7,height=5)\npar(mfrow=c(2, 3))\nplot(log(s1), log(s2))\nplot(log(s1), log(s3))\nplot(log(s1), log(s4))\nplot(log(s2), log(s3))\nplot(log(s2), log(s4))\nplot(log(s3), log(s4))\ndev.off()\n\n\nlibrary(NBPSeq)\n\narab.dat <- arab.3[, 3:dim(arab.3)[2]] \n# keep the count read column only\n\nhead(arab.dat)\narab.dat <- as.matrix(arab.dat)\n\nnb.data <- prepare.nb.data(arab.dat)\nnames(nb.data)\n\n\n\n\n\narab.nozero <- arab.dat[, which(arab!=0)]\n\narab.dat[arab.dat==0]=NA\nrho <- cor(arab.dat, use=\"complete.obs\")\nround(rho, 2)\nc(min(rho), max(rho))\nrho.log <- cor(log(arab.dat), use=\"complete.obs\")\nround(rho.log, 2)\n\nround(rho.log, 2)\n\n\nplot.nb.data(nb.data)\nhead(nb.data$counts)\ngrp.ids <- c(1, 1, 1, 2,2, 3,3,3, 4, 4, 4)\nobj <- prepare.nbp(as.matrix(arab.dat), grp.ids)\nobj2 <- estimate.disp(obj)\n\n\n### estimate.dispersion is the function that gives dispersion estimate\n# similaryly, we can estimate dispersion here\n# specify the design matrix\nx <- matrix(c(\n  rep(1, 11), \n  rep(1, 3), rep(0, 8),\n  rep(0, 3), 1, 1, rep(0, 6),\n  rep(0, 5), 1, 1, 1, rep(0, 3),\n  rep(0, 8), rep(1, 3)\n  ), 11, 5\n  )\n\n\n# estimate dispersion by NBQ model\n\nptm <- proc.time()\ndisp <- estimate.dispersion(nb.data, x)\nproc.time() - ptm\n# may cause 10,000 seconds to run \n# therefore I store it in a txt file\nwrite.table(disp$estimates, \"/home/zhuob/Dropbox/Zhuo/Project_2014/arab/dispersion.txt\")\ndd <- read.table(\"/home/zhuob/Dropbox/Zhuo/Project_2014/arab/dispersion.txt\")\n\n\nhead(disp$estimates) # pull out the first few entries\nhead(nb.data$rel.fre)\nrel <- log( as.vector(nb.data$rel.fre))\ndisper <- log(disp$estimates)\nlength(disper)\n\nplot(rel, disper, pch=20, cex=0.5)\n\n## create MA plot\nnames(obj)\n\n\ns1 <- rowSums(arab.dat[, 1:3])\ns2 <- rowSums(arab.dat[, 4:5])\ns3 <- rowSums(arab.dat[, 6:8])\ns4 <- rowSums(arab.dat[, 9:11])\nm <- obj$pseudo.lib.s[1]\nlog.fc.12 <- log2( (s2/2/m)/(s1/3/m)  )\nmu <- rowMeans(arab.dat[, 1:5])\npi.12 <- mu/m\n\npi.13 <- (s1+s3)/6/m\nlog.fc.13 <- log2( (s3/3/m)/(s1/3/m))\n\npi.14 <- (s1+s4)/6/m\nlog.fc.14 <- log2( (s4/3/m)/(s1/3/m))\n\npi.23 <- (s2+s3)/5/m\nlog.fc.23 <- log2( (s3/3/m)/(s2/2/m))\n\npi.24 <- (s2+s4)/6/m\nlog.fc.24 <- log2( (s4/3/m)/(s2/2/m))\n\npi.34 <- (s3+s4)/6/m\nlog.fc.34 <- log2( (s4/3/m)/(s3/3/m))\n\n\npdf(\"/home/zhuob/Dropbox/Zhuo/Project_2014/arab/maplot.pdf\"\n    ,width=7,height=5)\n\nplot(pi.12, log.fc.12, cex=0.5, pch=3, log=\"x\", col=\"grey\", \n     main=\"MA plot of group 1 vs. group2\")\n\nplot(pi.13, log.fc.13, cex=0.5, pch=3, log=\"x\", col=\"cyan\", \n     main=\"MA plot of group 1 vs. group 3\")\n\nplot(pi.14, log.fc.14, cex=0.5, pch=3, log=\"x\", col=\"red\", \n     main=\"MA plot of group 1 vs. group 4\")\n\nplot(pi.23, log.fc.23, cex=0.5, pch=3, log=\"x\", col=\"blue\", \n     main=\"MA plot of group 2 vs. group 3\")\n\nplot(pi.24, log.fc.24, cex=0.5, pch=3, log=\"x\", col=\"pink\", \n     main=\"MA plot of group 2 vs. group 4\")\n\nplot(pi.34, log.fc.34, cex=0.5, pch=3, log=\"x\", col=\"black\", \n     main=\"MA plot of group 3 vs. group 4\")\n\ndev.off()\n\n?glm\n\n## package glmmADMB deals with count data via glmm\nlibrary(glmmADMB)\n\n### get a random subset of arab.dat to run this glmm model\n#   treat gene id as a fixed effect, and group as random effect.\n\nset.seed(99)\nid <- sample (1:dim(arab.dat)[1], 2)\ny <- arab.dat[id, ]\n\ngroup <- as.factor(c(1, 1,1, 2,2,3,3,3, 4, 4, 4))\ny.new <- as.vector(y)\ngene <- as.factor(rep(c(1:dim(y)[1]), 11))\ngroup.new <- rep(group, each=dim(y)[1])\nc(length(y.new), length(gene), length(group.new))\n\nhead(cbind(y.new,gene, group.new), 30)\n\na <- glmmadmb(y.new ~ gene +( 1 | group.new),zeroInflation=F, \n             family = \"nbinom\")\n\nsummary(a)\n\narab.nozero <- arab.dat[rowSums(arab.dat)!=0, ]\n\nn <- 200\nset.seed(21)\nid <- sample (1:dim(arab.nozero)[1], n)\nvari <- c()\nfor (i in 1:n){\n  y <- arab.nozero[id[i], ]\n  a <- glmmadmb(y ~1, random=  ~1 | group, zeroInflation=F, \n            link=\"log\",  family = \"nbinom\")\n  vari[i] <- as.numeric(a$S)  #### output the variance\n  }\n\nhist(log(vari), main=\"number of genes = 200\")\n\nrange(vari)\n?glmmadmb\n\nglmmADMB:::glmmadmb\n\n\n\n",
    "created" : 1395161593702.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2239300069",
    "id" : "DBE06938",
    "lastKnownWriteTime" : 1395175671,
    "path" : "~/Dropbox/Zhuo/Project_2014/arab/explore.R",
    "project_path" : "explore.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}